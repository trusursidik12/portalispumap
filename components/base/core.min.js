'use strict';(function(){function ZemezCore(options){var _this=this;try{var observer=new MutationObserver(function(mutationsList,observer){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=mutationsList[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var mutation=_step.value;if(mutation.type==='childList'&&mutation.addedNodes.length){mutation.addedNodes.forEach(function(node){if(node.nodeType===Node.ELEMENT_NODE){_this.initComponents(node)}})}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}});this.initComponents();observer.observe(document,{childList:true,subtree:true})}catch(error){if(options.onError instanceof Function){options.onError(error)}else{console.warn('[ZemezCore] error:',error)}}}ZemezCore.prototype.checkComponent=function(name){return new Promise(function(resolve){var component=window.components[name];if(!component||component.state==='absent'){resolve()}else{if(component.state==='ready'){resolve()}else{window.addEventListener(name+':readyScripts',resolve)}}})};ZemezCore.prototype.makeAsync=function(params,cb){var inclusions=[];params.forEach(function(path){inclusions.push(cb(path))});return Promise.all(inclusions)};ZemezCore.prototype.makeSync=function(params,cb){var chain=Promise.resolve();params.forEach(function(path){chain=chain.then(cb.bind(null,path))});return chain};ZemezCore.prototype.includeStyles=function(path){return new Promise(function(resolve){if(document.querySelector('link[href="'+path+'"]')){resolve()}else{var link=document.createElement('link');link.setAttribute('rel','stylesheet');link.setAttribute('href',path);link.addEventListener('load',resolve);document.querySelector('head').appendChild(link)}})};ZemezCore.prototype.includeScript=function(path){return new Promise(function(resolve){var node=document.querySelector('script[src="'+path+'"]');if(node){if(node.getAttribute('data-loaded')==='true'){resolve()}else{node.addEventListener('load',resolve)}}else{var script=document.createElement('script');script.src=path;script.addEventListener('load',function(){script.setAttribute('data-loaded','true');resolve()});document.querySelector('head').appendChild(script)}})};ZemezCore.prototype.initComponent=function(component){var stylesState=Promise.resolve(),scriptsState=Promise.resolve();console.log('%c['+component.name+'] init:','color: lightgreen; font-weight: 900;',component.nodes.length);component.state='load';if(component.styles){stylesState=stylesState.then(this.makeAsync.bind(null,component.styles,this.includeStyles))}if(component.script){scriptsState=scriptsState.then(this.makeSync.bind(null,component.script,this.includeScript))}if(component.dependencies){scriptsState=scriptsState.then(this.makeSync.bind(null,component.dependencies,this.checkComponent))}if(component.init){scriptsState=scriptsState.then(component.init.bind(null,component.nodes))}stylesState.then(function(){window.dispatchEvent(new Event(component.name+':readyStyles'))});scriptsState.then(function(){window.dispatchEvent(new Event(component.name+':readyScripts'));component.state='ready'});return{scriptsState:scriptsState,stylesState:stylesState}};ZemezCore.prototype.initComponents=function(node){var stylesPromises=[],scriptsPromises=[];if(!window.components)throw new Error('window.components is not defined');components=window.components;node=node||document;for(var key in components){var component=components[key];component.name=key;component.nodes=Array.from(node.querySelectorAll(component.selector));if(node.constructor.name==='HTMLElement'&&node.matches(component.selector)){component.nodes.unshift(node)}if(component.styles&&!(component.styles instanceof Array)){component.styles=[component.styles]}if(component.script&&!(component.script instanceof Array)){component.script=[component.script]}if(component.dependencies&&!(component.dependencies instanceof Array)){component.dependencies=[component.dependencies]}if(component.nodes.length){component.state='pending'}else{component.state='absent'}}for(var _key in components){var _component=components[_key];if(_component.state==='pending'){var componentPromises=this.initComponent(_component);stylesPromises.push(componentPromises.stylesState);scriptsPromises.push(componentPromises.scriptsState)}}Promise.all(scriptsPromises).then(function(){window.dispatchEvent(new Event('components:ready'))});Promise.all(stylesPromises).then(function(){window.dispatchEvent(new Event('components:stylesReady'))})};if(!window.ZemezCore){window.ZemezCore=ZemezCore}}).call();